var connection = require("Conexion");

module.exports = CrearUsuario;

function CrearUsuario(usuario, password, nombre_completo, sexo, foto, fecha_nacimiento, callback) {

    var conexion = connection.getConexion();
    if (callback === undefined) {
        callback = function () {};
    }
    conexion.connect(function (err) {
        if (err) {
            callback(err);
        } else {
            var sql = "select Nombre_Usuario " +
                    "from usuario " +
                    "where usuario.Nombre_Usuario = ?";
            conexion.query(sql, [usuario], function (err, filas) {
                if (err) {
                    callback(err);
                } else {
                    if (filas.length !== 0) {
                        callback(null, false);
                    } else {
                        sql = "INSERT INTO `usuario` (`ID`, `Nombre_Usuario`, `Password`, `Nombre_Completo`, `Sexo`, `Foto`, `Fecha_Nacimiento`)" +
                                " VALUES (NULL, ?, ?, ?, ?, ?, ?);";
                        conexion.query(sql, [usuario, password, nombre_completo, sexo, foto, fecha_nacimiento], function (err) {
                            if (err) {
                                callback(err);
                            } else {
                                callback(null, true);
                            }
                            conexion.end();
                        });
                    }
                }
            });
        }
    });
}
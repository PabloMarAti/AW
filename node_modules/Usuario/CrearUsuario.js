var connection = require("Conexion");

module.exports = CrearUsuario;

function CrearUsuario(usuario, password, nombre_completo, sexo, foto, fecha_nacimiento, callback) {

    var conexion = connection.getConexion();
    if (callback === undefined) {
        callback = function () {};
    }
    conexion.connect(function (err) {
        if (err) {
            callback(err);
        } else {
            var sql = "select Nombre_Usuario " +
                    "from usuario " +
                    "where usuario.Nombre_Usuario = '" + usuario + "'";
            conexion.query(sql, function (err, filas) {
                if (err) {
                    callback(err);
                } else {
                    if (filas.length !== 0) {
                        callback(null, "Ya existe el Usuario: " + usuario);
                    } else {
                        sql = "INSERT INTO `usuario` (`ID`, `Nombre_Usuario`, `Password`, `Nombre_Completo`, `Sexo`, `Foto`, `Fecha_Nacimiento`)" +
                                " VALUES (NULL, '" + usuario + "', '" + password + "', '" + nombre_completo + "', '" + sexo + "', '" + foto + "', '" + fecha_nacimiento + "');";
                        conexion.query(sql, function (err) {
                            if (err) {
                                callback(err);
                            } else {
                                callback(null, "Se ha introducido con Ã©xito");
                            }
                        });
                    }
                }
                conexion.end();
            });
        }
    });
}
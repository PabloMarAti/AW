var connection = require("Conexion");

module.exports = InicializarTablero;

function InicializarTablero(partida, callback) {
    var conexion = connection.getConexion();
    if (callback === undefined) {
        callback = function () {};
    }
    conexion.connect(function (err) {
        if (!err) {
            var sql = "select partidas.ID as partida , usuario.ID as user from partidas,usuario where partidas.Nombre = ? and partidas.Creador = usuario.Nombre_usuario;";

            conexion.query(sql, [partida], function (err, resultado) {
                if (!err) {
                    var ID_partida = resultado[0].partida;
                    var creador = resultado[0].user;

                    sql = "INSERT INTO `poner` (`ID`, `ID_Usuario`, `ID_Partida`, `ID_Carta`, `Fila`, `Columna`, `Descubierta`) " +
                            "VALUES (NULL, ?, ?, '1', ?, ?, '1');";

                    conexion.query(sql, [creador, ID_partida, "3", "0"], function (err, resultado) {
                        if (!err) {
                            var oro = Math.floor(Math.random() * 3);
                            switch (oro) {
                                case 0:
                                    sql = "INSERT INTO `poner` (`ID`, `ID_Usuario`, `ID_Partida`, `ID_Carta`, `Fila`, `Columna` , `Descubierta`) " +
                                            "VALUES (NULL, '" + creador + "', '" + ID_partida + "', '2', '" + 1 + "', '" + 6 + "','0'), " +
                                            "(NULL, '" + creador + "', '" + ID_partida + "', '3', '" + 3 + "', '" + 6 + "','0'), " +
                                            "(NULL, '" + creador + "', '" + ID_partida + "', '3', '" + 5 + "', '" + 6 + "','0');";
                                    break;
                                case 1:
                                    sql = "INSERT INTO `poner` (`ID`, `ID_Usuario`, `ID_Partida`, `ID_Carta`, `Fila`, `Columna`, `Descubierta`) " +
                                            "VALUES (NULL, '" + creador + "', '" + ID_partida + "', '3', '" + 1 + "', '" + 6 + "','0'), " +
                                            "(NULL, '" + creador + "', '" + ID_partida + "', '2', '" + 3 + "', '" + 6 + "','0'), " +
                                            "(NULL, '" + creador + "', '" + ID_partida + "', '3', '" + 5 + "', '" + 6 + "','0');";
                                    break;
                                case 2:
                                    sql = "INSERT INTO `poner` (`ID`, `ID_Usuario`, `ID_Partida`, `ID_Carta`, `Fila`, `Columna`, `Descubierta`) " +
                                            "VALUES (NULL, '" + creador + "', '" + ID_partida + "', '3', '" + 1 + "', '" + 6 + "','0'), " +
                                            "(NULL, '" + creador + "', '" + ID_partida + "', '3', '" + 3 + "', '" + 6 + "','0'), " +
                                            "(NULL, '" + creador + "', '" + ID_partida + "', '2', '" + 5 + "', '" + 6 + "','0');";
                                    break;
                            }
                            conexion.query(sql, function (err, resultado) {
                                if (!err) {
                                    callback(null, resultado);
                                } else {
                                    callback(err);
                                }
                                conexion.end();
                            });
                        } else {
                            callback(err);
                        }
                    });
                } else {
                    callback(err);
                }
            });
        } else {

        }
    });
}
var connection = require("Conexion");

module.exports = LeerComentariosPartida;

function LeerComentariosPartida(partida, callback) {
    var conexion = connection.getConexion();
    if (callback === undefined) {
        callback = function () {};
    }

    conexion.connect(function (err) {
        if (!err) {
            var sql = "select ID from partidas where partidas.Nombre = '" + partida + "';";

            conexion.query(sql, function (err, resultado) {
                if (!err) {
                    var IDPartida = resultado[0].ID;
                    sql = "select comentarios.Texto, usuario.Foto, usuario.Nombre_Usuario " +
                            "from comentarios,usuario " +
                            "where comentarios.ID_Partida = '" + IDPartida + "' and comentarios.ID_Usuario = usuario.ID;";

                    conexion.query(sql, function (err, resultado) {
                        if (!err) {
                            callback(null, resultado);
                        } else {
                            callback(err);
                        }
                        conexion.end();
                    });
                } else {
                    callback(err);
                }
            });
        } else {
            callback(err);
        }
    });
}
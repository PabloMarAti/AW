var connection = require("Conexion");

module.exports = CambiarCarta;

//Cambia la carta de una mano de un jugador, ya sea por descartar una carta o por haberla puesto en el tablero
function CambiarCarta(partida, usuario, carta, callback){
    var conexion = connection.getConexion();
    if (callback === undefined) {
        callback = function () {};
    }

    conexion.connect(function (err) {
        if (!err) {
           var sql = "Select partidas.ID as game, usuario.ID as user " +
                     "from partidas, usuario " +
                     "where partidas.Nombre = '" + partida + "' and usuario.Nombre_Usuario = '" + usuario + "';";
             
            conexion.query(sql, function (err, resultado){
                if (!err) {
                    sql = "update tiene " +
                            "set ID_Carta = '" + Math.floor((Math.random() * 15) + 5) + "' " +
                            "where ID_Carta = '" + carta + "' and ID_Usuario = '" + resultado[0].user + "' and ID_Partida = '" + resultado[0].game + "' " + 
                            "LIMIT 1;";
                    conexion.query(sql, function (err, resultado) {
                        if (!err) {
                            callback(null, resultado);
                        } else {
                            callback(err);
                        }
                        conexion.end();
                    });
                } else {
                    callback(err);
                }
            });
        } else {
            callback(err);
        }
    });
}
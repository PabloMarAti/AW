var connection = require("Conexion");

module.exports = LeerMano;

//Esta funcion lee las cartas que tiene un usuario en una partida
function LeerMano (partida, usuario, callback) {

    if (callback === undefined) {
        callback = function () {};
    }

    var conexion = connection.getConexion();
    
    //Cogemos el ID de la partida
    conexion.connect(function (err){
       if(!err){
            var sql = "select ID from partidas where Nombre = ?;";

            //Cogemos el ID del usuario
            conexion.query(sql, [partida], function (err, IDPartida) {
                if (!err) {
                    sql = "select ID from usuario where Nombre_Usuario = ?;";
                    
                    //Cogemos las cartas del usuario en partida
                    conexion.query(sql, [usuario], function (err, IDUsuario) {
                        if (!err) {
                            sql = "select ID_Carta, URL " + 
                                  "from tiene, cartas " + 
                                  "where tiene.ID_Partida = ? and tiene.ID_Usuario = ? and tiene.ID_Carta = cartas.ID;";
                            conexion.query(sql, [IDPartida[0].ID, IDUsuario[0].ID], function (err, mano){
                                if(!err){
                                    callback(null, mano);
                                } else{
                                    callback(err);
                                }
                                conexion.end();
                            });
                        } else {
                            callback(err);
                        }
                    });
                } else {
                    callback(err);
                }
            });
        } else{
            callback(err);
        }
    });
}